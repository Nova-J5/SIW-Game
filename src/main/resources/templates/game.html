<!DOCTYPE html>
<html>
	<head>
		<title>
			Gioco
		</title>
		<div th:replace="fragments/css :: css-dep"></div>
		<link rel="stylesheet" href="/css/game_style.css"/>		
	</head>

	<body>
		<div th:replace="fragments/navbar :: navbar"></div>
		
		<div class="container">
		    <div th:if="${game}">
				
			<div class="row">
				
				<div class="col">
			    	<span>
						<div class="mt-3" th:if="${game.imageForGames} != null">
							<img class="rounded-2 w-100" th:src="@{'/display/image/' + ${game.imageForGames.id}}" />
							<div th:if="${currentUser != null && currentUser.isAdmin()}">
								<a th:href="@{'/admin/removeImageFromGame/' + ${game.id}}"><button type="button" class="btn btn-success my-3"> Rimuovi immagine </button></a>
							</div>
				        </div>
					</span>

					<span>
				        <div th:if="${game.imageForGames} == null">
				        	<img class="rounded-1 w-100" src="/images/image-not-available.jpeg" />
				        	<div th:if="${currentUser != null && currentUser.isAdmin()}">
								<div>Aggiungi una foto del gioco</div>
						        	<form method="POST" enctype="multipart/form-data" th:action="@{'/admin/addImageToGame/' + ${game.id}}">
						        	<input type="file" name="file" class="my-2 form-control" style="max-width: 280px;" required />
					        	<button type="submit" class="btn btn-success">Aggiungi immagine</button>
					        	</form>
							</div>
				        </div>
					</span>
					
				</div>
				
				<div class="col">
				    <h1 class="mt-3" th:text="${game.title}"></h1>
				    <div th:if="${game.avgScore()}">
						<span> Voto: </span>
				    	<span th:text="${game.avgScore()}"></span>
				    	<span th:utext="${game.printStars(game.intAvgScore())}"></span>
				    </div>
			        <div>Anno di rilascio: <b><span th:text="${game.year}"></span></b></div>
			        <div>
				    	<span>Sviluppatore: <b><a class="text-decoration-none" th:href="@{'/developer/' + ${game.developer.id}}" th:text="${game.developer.name}"> Sviluppatore </a></b></span>  	
					</div>
			        <div>
				    	<span>Piattaforme: 
							<ul th:if="${!game.platforms.isEmpty()}" class="list-group list-group-horizontal">
								<li class="list-group-item border-0" th:each="platform : ${game.platforms}">
									<b><a th:href="@{'/platform/' + ${platform.id}}" class="text-decoration-none" th:text="${platform.name}"></a></b>
								</li>
							</ul>
							<span th:if="${game.platforms.isEmpty()}"> nessuna</span>
						</span>
					</div>
			        <div>
				    	<span>Generi: 
							<ul th:if="${!game.genres.isEmpty()}" class="list-group list-group-horizontal">
								<li class="border-0 list-group-item" th:each="genre : ${game.genres}">
									<b><a th:href="@{'/genre/' + ${genre.id}}" class="text-decoration-none" th:text="${genre.name}"></a></b>
								</li>
							</ul>
							<span th:if="${game.genres.isEmpty()}"> nessuno</span>
						</span>
					</div>

				</div>
			</div>
		<div class="row">
			<h3 class="mt-2">Descrizione</h3>
			<p th:text="${game.description}"></p>

		</div>


			    

		       	<div th:if="${currentUser != null && currentUser.isAuth()}">
					<a th:href="@{'/addPlayed/' + ${game.id}}">L'ho giocato!</a>
					<a th:href="@{'/addCurrentlyPlaying/' + ${game.id}}">Lo sto giocando!</a>
				</div>
				
			    <div th:if="${currentUser != null && currentUser.isAdmin()}">
			    	<a th:href="@{'/admin/updateTitleAndDesc/' + ${game.id}}" >modifica titolo e descrizione</a><br>
			    	<a th:href="@{'/admin/updatePlatAndGen/' + ${game.id}}">modifica generi e piattaforme</a>
			    </div>
		        


		    	<div th:if="${!game.reviews.isEmpty()}" >
					<h3 class="mt-5"> Recensioni: </h3>
					<li th:each="review: ${game.reviews}" th:remove="tag">
						<div class="border rounded bg-light text-dark p-3 my-3" style="width: 1000px">
						<h5 th:text="${review.user.name} + ' ' + ${review.user.surname} + ' (' + ${review.user.credentials.username} + ')'"> </h5>
	                        <span th:utext="${game.printStars(review.score)}"></span>
	                  
						
						<span class="h5" th:text="${review.title}"></span>
						<div th:text="${review.body}" ></div>
					</div>
					</li>
				</div>
				<div th:if="${currentUser != null && currentUser.isAuth()}">
			    	<a th:href="@{'/default/formNewReview/' + ${game.id}}">Aggiungi recensione</a>
			    </div>
		    <div th:unless="${game}">Non esiste</div>
		</div>
	 </body>
</html>
